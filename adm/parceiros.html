<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Parceiros</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h1 { color: #333; }
    form { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,.1); margin-bottom: 20px; }
    label { display:block; margin-top:10px; font-weight: bold; }
    input, select, textarea { width: 100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:5px; }
    button { margin-top:15px; padding:10px 15px; border:none; border-radius:5px; background:#007BFF; color:#fff; cursor:pointer; }
    button:hover { background:#0056b3; }
    table { width:100%; border-collapse: collapse; background:#fff; box-shadow: 0 2px 5px rgba(0,0,0,.1);}
    th, td { border:1px solid #ddd; padding:10px; text-align:left; }
    th { background:#007BFF; color:#fff; }
    .actions button { margin-right: 5px; }
  </style>
</head>
<body>
  <h1>Cadastro de Parceiros</h1>

  <form id="partnerForm">
    <input type="hidden" id="partnerId" />

    <h3>Dados da Empresa</h3>
    <label>Nome da Empresa</label>
    <input type="text" id="nomeEmpresa" required>
    <label>CNPJ / CPF</label>
    <input type="text" id="cnpj">
    <label>Telefone</label>
    <input type="text" id="telefoneEmpresa">
    <label>CEP</label>
    <input type="text" id="cep" onblur="buscarCEP()">
    <label>Rua</label>
    <input type="text" id="rua">
    <label>Número</label>
    <input type="text" id="numero">
    <label>Bairro</label>
    <input type="text" id="bairro">
    <label>Cidade</label>
    <input type="text" id="cidade">
    <label>Estado</label>
    <input type="text" id="estado">
    <label>Website / Redes sociais</label>
    <input type="text" id="site">

    <h3>Serviços</h3>
    <label><input type="checkbox" value="Banho & Tosa" class="servico"> Banho & Tosa</label>
    <label><input type="checkbox" value="Creche" class="servico"> Creche</label>
    <label><input type="checkbox" value="Hospedagem" class="servico"> Hospedagem</label>
    <label><input type="checkbox" value="Dog Walker" class="servico"> Dog Walker</label>
    <label><input type="checkbox" value="Pet Sitter" class="servico"> Pet Sitter</label>
    <label><input type="checkbox" value="Adestramento" class="servico"> Adestramento</label>
    <label>Outros</label>
    <input type="text" id="outrosServicos">

    <h3>Responsável</h3>
    <label>Nome</label>
    <input type="text" id="responsavelNome">
    <label>Telefone</label>
    <input type="text" id="responsavelTelefone">
    <label>E-mail</label>
    <input type="email" id="responsavelEmail">
    <label>Cargo / Função</label>
    <input type="text" id="responsavelCargo">

    <h3>Financeiro</h3>
    <label>Faixa de Faturamento</label>
    <input type="text" id="faturamento">
    <label>Formas de pagamento</label>
    <input type="text" id="pagamento">
    <label>Limite de Crédito</label>
    <input type="text" id="credito">
    <label>Observações</label>
    <textarea id="observacoes"></textarea>
    <label>Status</label>
    <select id="status">
      <option value="Ativo">Ativo</option>
      <option value="Inativo">Inativo</option>
    </select>

    <button type="submit">Salvar Parceiro</button>
  </form>

  <h2>Lista de Parceiros</h2>
  <table>
    <thead>
      <tr>
        <th>Nome da Empresa</th>
        <th>Telefone</th>
        <th>Cidade</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="partnersList"></tbody>
  </table>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
const firebaseConfig = {
  apiKey: "AIzaSyDVr6OOQRt2rB0kByInjqjdyoQCpnMAt7I",
  authDomain: "site-f6495.firebaseapp.com",
  projectId: "site-f6495",
  storageBucket: "site-f6495.firebasestorage.app",
  messagingSenderId: "230161402024",
  appId: "1:230161402024:web:462a911919ebf8a0809a9d",
  measurementId: "G-51G8XF6JH0"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Buscar CEP
    function buscarCEP() {
      const cep = document.getElementById("cep").value.replace(/\D/g, '');
      if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(res => res.json())
          .then(data => {
            if (!data.erro) {
              document.getElementById("rua").value = data.logradouro;
              document.getElementById("bairro").value = data.bairro;
              document.getElementById("cidade").value = data.localidade;
              document.getElementById("estado").value = data.uf;
            }
          });
      }
    }

    // Salvar ou atualizar
    document.getElementById("partnerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("partnerId").value;
      const servicos = [...document.querySelectorAll(".servico:checked")].map(cb => cb.value);
      if (document.getElementById("outrosServicos").value) {
        servicos.push(document.getElementById("outrosServicos").value);
      }
      const parceiro = {
        nomeEmpresa: document.getElementById("nomeEmpresa").value,
        cnpj: document.getElementById("cnpj").value,
        telefoneEmpresa: document.getElementById("telefoneEmpresa").value,
        cep: document.getElementById("cep").value,
        rua: document.getElementById("rua").value,
        numero: document.getElementById("numero").value,
        bairro: document.getElementById("bairro").value,
        cidade: document.getElementById("cidade").value,
        estado: document.getElementById("estado").value,
        site: document.getElementById("site").value,
        servicos,
        responsavelNome: document.getElementById("responsavelNome").value,
        responsavelTelefone: document.getElementById("responsavelTelefone").value,
        responsavelEmail: document.getElementById("responsavelEmail").value,
        responsavelCargo: document.getElementById("responsavelCargo").value,
        faturamento: document.getElementById("faturamento").value,
        pagamento: document.getElementById("pagamento").value,
        credito: document.getElementById("credito").value,
        observacoes: document.getElementById("observacoes").value,
        status: document.getElementById("status").value
      };
      if (id) {
        await db.collection("parceiros").doc(id).update(parceiro);
      } else {
        await db.collection("parceiros").add(parceiro);
      }
      document.getElementById("partnerForm").reset();
      document.getElementById("partnerId").value = "";
      carregarParceiros();
    });

    // Carregar parceiros
    async function carregarParceiros() {
      const lista = document.getElementById("partnersList");
      lista.innerHTML = "";
      const snap = await db.collection("parceiros").get();
      snap.forEach(doc => {
        const p = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.nomeEmpresa}</td>
          <td>${p.telefoneEmpresa}</td>
          <td>${p.cidade}</td>
          <td>${p.status}</td>
          <td class="actions">
            <button onclick="editarParceiro('${doc.id}')">Editar</button>
            <button onclick="apagarParceiro('${doc.id}')">Excluir</button>
          </td>
        `;
        lista.appendChild(tr);
      });
    }

    // Editar
    async function editarParceiro(id) {
      const docSnap = await db.collection("parceiros").doc(id).get();
      const p = docSnap.data();
      document.getElementById("partnerId").value = id;
      document.getElementById("nomeEmpresa").value = p.nomeEmpresa;
      document.getElementById("cnpj").value = p.cnpj;
      document.getElementById("telefoneEmpresa").value = p.telefoneEmpresa;
      document.getElementById("cep").value = p.cep;
      document.getElementById("rua").value = p.rua;
      document.getElementById("numero").value = p.numero;
      document.getElementById("bairro").value = p.bairro;
      document.getElementById("cidade").value = p.cidade;
      document.getElementById("estado").value = p.estado;
      document.getElementById("site").value = p.site;
      document.querySelectorAll(".servico").forEach(cb => {
        cb.checked = p.servicos?.includes(cb.value);
      });
      document.getElementById("outrosServicos").value = "";
      document.getElementById("responsavelNome").value = p.responsavelNome;
      document.getElementById("responsavelTelefone").value = p.responsavelTelefone;
      document.getElementById("responsavelEmail").value = p.responsavelEmail;
      document.getElementById("responsavelCargo").value = p.responsavelCargo;
      document.getElementById("faturamento").value = p.faturamento;
      document.getElementById("pagamento").value = p.pagamento;
      document.getElementById("credito").value = p.credito;
      document.getElementById("observacoes").value = p.observacoes;
      document.getElementById("status").value = p.status;
    }

    // Apagar
    async function apagarParceiro(id) {
      if (confirm("Tem certeza que deseja excluir este parceiro?")) {
        await db.collection("parceiros").doc(id).delete();
        carregarParceiros();
      }
    }

    carregarParceiros();
  </script>
</body>
</html>
