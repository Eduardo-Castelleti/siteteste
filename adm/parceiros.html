<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Parceiros</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
    body { display:flex; height:100vh; background:#f4f6f9; }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background: #2c3e50;
      color: #fff;
      display:flex;
      flex-direction:column;
      padding:20px 0;
    }
    .sidebar h2 {
      text-align:center;
      margin-bottom:30px;
      font-size:20px;
    }
    .sidebar a {
      color:#fff;
      padding:15px 20px;
      text-decoration:none;
      display:flex;
      align-items:center;
      transition:background 0.3s;
    }
    .sidebar a:hover { background:#34495e; }
    .sidebar a i { margin-right:10px; }

    /* Conteúdo principal */
    .main {
      flex:1;
      padding:20px;
      overflow:auto;
    }
    h1 { margin-bottom:20px; }

    /* Botão */
    button {
      background:#3498db; color:#fff; border:none; padding:10px 15px; 
      border-radius:5px; cursor:pointer; margin-bottom:20px;
    }
    button:hover { background:#2980b9; }

    /* Tabela */
    table { width:100%; border-collapse:collapse; margin-top:20px; background:#fff; border-radius:8px; overflow:hidden; }
    th, td { padding:12px; border-bottom:1px solid #ddd; text-align:left; }
    th { background:#3498db; color:#fff; }
    tr:hover { background:#f1f1f1; }

    /* Modal */
    .modal {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
      background:rgba(0,0,0,0.5); justify-content:center; align-items:center;
    }
    .modal-content {
      background:#fff; padding:20px; border-radius:10px; width:400px; max-width:90%;
    }
    .modal-content h2 { margin-bottom:15px; }
    .modal-content input { width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px; }
    .modal-content button { width:100%; margin-top:10px; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Admin</h2>
    <a href="clientes.html"><i class="fa fa-users"></i> Clientes</a>
    <a href="parceiros.html"><i class="fa fa-handshake"></i> Parceiros</a>
    <a href="funcionarios.html"><i class="fa fa-user-tie"></i> Funcionários</a>
    <a href="index.html"><i class="fa fa-home"></i> Início</a>
  </div>

  <!-- Conteúdo principal -->
  <div class="main">
    <h1>Gerenciar Parceiros</h1>
    <button onclick="openModal()">Adicionar Parceiro</button>
    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Telefone</th>
          <th>CNPJ/CPF</th>
        </tr>
      </thead>
      <tbody id="partners-list"></tbody>
    </table>
  </div>

  <!-- Modal -->
  <div class="modal" id="partnerModal">
    <div class="modal-content">
      <h2>Adicionar Parceiro</h2>
      <input type="text" id="partnerName" placeholder="Nome">
      <input type="email" id="partnerEmail" placeholder="Email">
      <input type="password" id="partnerPassword" placeholder="Senha">
      <input type="text" id="partnerPhone" placeholder="Telefone">
      <input type="text" id="partnerCNPJ" placeholder="CNPJ / CPF">
      <button onclick="addPartner()">Salvar</button>
      <button onclick="closeModal()">Cancelar</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_MSG_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const modal = document.getElementById("partnerModal");

    function openModal() { modal.style.display = "flex"; }
    function closeModal() { modal.style.display = "none"; }

    async function addPartner() {
      const name = document.getElementById("partnerName").value;
      const email = document.getElementById("partnerEmail").value;
      const password = document.getElementById("partnerPassword").value;
      const phone = document.getElementById("partnerPhone").value;
      const cnpj = document.getElementById("partnerCNPJ").value;

      if (!name || !email || !password) {
        alert("Preencha todos os campos obrigatórios!");
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const uid = userCredential.user.uid;

        await addDoc(collection(db, "parceiros"), {
          uid,
          name,
          email,
          phone,
          cnpj,
          createdAt: new Date()
        });

        alert("Parceiro adicionado com sucesso!");
        closeModal();
      } catch (error) {
        alert("Erro: " + error.message);
      }
    }

    // Listar em tempo real
    const partnersList = document.getElementById("partners-list");
    onSnapshot(collection(db, "parceiros"), (snapshot) => {
      partnersList.innerHTML = "";
      snapshot.forEach(doc => {
        const partner = doc.data();
        const row = `<tr>
          <td>${partner.name}</td>
          <td>${partner.email}</td>
          <td>${partner.phone || "-"}</td>
          <td>${partner.cnpj || "-"}</td>
        </tr>`;
        partnersList.innerHTML += row;
      });
    });

    window.openModal = openModal;
    window.closeModal = closeModal;
    window.addPartner = addPartner;
  </script>

</body>
</html>
