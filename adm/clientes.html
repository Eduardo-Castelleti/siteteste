<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Clientes</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, sans-serif; }
body { background:#f4f6f9; color:#333; }
a { text-decoration:none; color:inherit; }

/* MENU LATERAL */
.sidebar { position:fixed; left:0; top:0; bottom:0; width:250px; background:#2c3e50; color:#ecf0f1; padding-top:20px; }
.sidebar h2 { text-align:center; margin-bottom:20px; font-size:1.5em; }
.sidebar ul { list-style:none; }
.sidebar ul li { padding:15px 20px; cursor:pointer; display:flex; align-items:center; }
.sidebar ul li:hover { background:#34495e; }
.sidebar ul li i { margin-right:10px; }

/* CONTEÚDO */
.main-content { margin-left:250px; padding:20px; }

/* CARDS */
.cards { display:flex; gap:20px; flex-wrap:wrap; margin-bottom:30px; }
.card { background:#fff; flex:1; min-width:200px; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.card h3 { margin-bottom:10px; font-size:1.1em; color:#555; }
.card p { font-size:1.5em; font-weight:bold; color:#2c3e50; }

/* TABELA */
table { width:100%; border-collapse:collapse; background:#fff; margin-bottom:30px; border-radius:8px; overflow:hidden; }
table th, table td { padding:12px 15px; text-align:left; border-bottom:1px solid #ddd; }
table th { background-color:#2980b9; color:#fff; }
table tr:hover { background-color:#f1f1f1; }

/* BOTÕES */
button { padding:8px 12px; border:none; border-radius:5px; cursor:pointer; }
button.edit { background-color:#27ae60; color:#fff; }
button.delete { background-color:#c0392b; color:#fff; }
button.add { background-color:#2980b9; color:#fff; margin-bottom:10px; }

/* MODAIS */
.modal { display:none; position:fixed; top:0; left:0;width:100%;height:100%;background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content { background:#fff; padding:20px; border-radius:8px; width:400px; position:relative; }

@media(max-width:768px){ .sidebar{ width:200px; } .main-content{ margin-left:200px; } .cards{ flex-direction:column; } }
</style>
</head>
<body>

<div class="sidebar">
  <h2>Admin Petshop</h2>
  <ul>
    <li><i class="fas fa-tachometer-alt"></i> Dashboard</li>
    <li><i class="fas fa-user"></i> Clientes</li>
    <li><i class="fas fa-handshake"></i> Parceiros</li>
    <li><i class="fas fa-users"></i> Funcionários</li>
    <li><i class="fas fa-box"></i> Produtos</li>
  </ul>
</div>

<div class="main-content">
  <h1>Clientes</h1>

  <div class="cards">
    <div class="card"><h3>Clientes Ativos</h3><p id="clientesAtivos">0</p></div>
    <div class="card"><h3>Clientes Novos</h3><p id="clientesNovos">0</p></div>
    <div class="card"><h3>Ticket Médio</h3><p id="ticketMedio">--</p></div>
  </div>

  <div style="margin-bottom:20px;">
    <input type="text" id="buscaCliente" placeholder="Pesquisar cliente..." style="padding:8px;width:60%;">
    <button id="btnBuscar" style="padding:8px 12px;margin-left:5px;">Buscar</button>
    <button id="btnAdicionarCliente" class="add">Adicionar Cliente</button>
  </div>

  <table id="tabelaClientes" style="display:none;">
    <thead>
      <tr><th>Nome</th><th>Telefone</th><th>Email</th><th>Pets</th><th>Ações</th></tr>
    </thead>
    <tbody id="clientesTable"></tbody>
  </table>
</div>

<!-- MODAL ADICIONAR/EDITAR -->
<div id="modalCliente" class="modal">
  <div class="modal-content">
    <h3 id="tituloModal">Adicionar Cliente</h3>
    <form id="formCliente">
      <label>Nome:</label><br>
      <input type="text" id="nomeCliente" required style="width:100%;padding:8px;margin-bottom:10px;"><br>
      <label>Telefone:</label><br>
      <input type="text" id="telefoneCliente" required style="width:100%;padding:8px;margin-bottom:10px;"><br>
      <label>Email:</label><br>
      <input type="email" id="emailCliente" required style="width:100%;padding:8px;margin-bottom:10px;"><br>
      <label>Senha:</label><br>
      <input type="password" id="senhaCliente" required style="width:100%;padding:8px;margin-bottom:10px;"><br>
      <button type="submit" class="add">Salvar</button>
      <button type="button" id="btnCancelar" style="margin-left:5px;">Cancelar</button>
    </form>
    <button id="btnFecharModal" style="position:absolute; top:10px; right:10px;">&times;</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-database.js";

// CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyDVr6OOQRt2rB0kByInjqjdyoQCpnMAt7I",
  authDomain: "site-f6495.firebaseapp.com",
  projectId: "site-f6495",
  storageBucket: "site-f6495.firebasestorage.app",
  messagingSenderId: "230161402024",
  appId: "1:230161402024:web:462a911919ebf8a0809a9d",
  measurementId: "G-51G8XF6JH0"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let editId = null;

// ELEMENTOS
const btnAdicionar = document.getElementById('btnAdicionarCliente');
const btnCancelar = document.getElementById('btnCancelar');
const btnFechar = document.getElementById('btnFecharModal');
const formCliente = document.getElementById('formCliente');
const tabelaClientes = document.getElementById('clientesTable');

// ABRIR MODAL
btnAdicionar.addEventListener('click', ()=>{
  editId = null;
  formCliente.reset();
  document.getElementById('tituloModal').innerText = "Adicionar Cliente";
  document.getElementById('modalCliente').style.display='flex';
});

// FECHAR MODAL
btnCancelar.addEventListener('click', ()=>document.getElementById('modalCliente').style.display='none');
btnFechar.addEventListener('click', ()=>document.getElementById('modalCliente').style.display='none');

// SALVAR CLIENTE
formCliente.addEventListener('submit', (e)=>{
  e.preventDefault();
  const nome = document.getElementById('nomeCliente').value;
  const telefone = document.getElementById('telefoneCliente').value;
  const email = document.getElementById('emailCliente').value;
  const senha = document.getElementById('senhaCliente').value;

  if(editId){
    update(ref(db,'clientes/'+editId), {nome, telefone, email, senha})
      .then(()=>document.getElementById('modalCliente').style.display='none')
      .catch(err=>alert(err));
  } else {
    push(ref(db,'clientes'), {nome, telefone, email, senha, pets: []})
      .then(()=>document.getElementById('modalCliente').style.display='none')
      .catch(err=>alert(err));
  }
});

// BUSCAR CLIENTES
const buscarClientes = (filtro='')=>{
  onValue(ref(db,'clientes'), snapshot=>{
    tabelaClientes.innerHTML='';
    const clientes = snapshot.exists() ? Object.entries(snapshot.val()) : [];
    let count=0;
    clientes.forEach(([id,c])=>{
      if(filtro && !c.nome.toLowerCase().includes(filtro.toLowerCase()) &&
         !c.email.toLowerCase().includes(filtro.toLowerCase()) &&
         !c.telefone.includes(filtro)) return;
      count++;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${c.nome}</td>
        <td>${c.telefone}</td>
        <td>${c.email}</td>
        <td>${c.pets ? c.pets.join(', ') : ''}</td>
        <td>
          <button class="edit" onclick="editarCliente('${id}')">Editar</button>
          <button class="delete" onclick="excluirCliente('${id}')">Excluir</button>
        </td>`;
      tabelaClientes.appendChild(tr);
    });
    document.getElementById('tabelaClientes').style.display = count ? 'table' : 'none';
    document.getElementById('clientesAtivos').innerText = count;
  });
};

// FUNÇÕES EDITAR/EXCLUIR
window.editarCliente = (id)=>{
  onValue(ref(db,'clientes/'+id), snapshot=>{
    if(snapshot.exists()){
      const c = snapshot.val();
      document.getElementById('nomeCliente').value = c.nome;
      document.getElementById('telefoneCliente').value = c.telefone;
      document.getElementById('emailCliente').value = c.email;
      document.getElementById('senhaCliente').value = c.senha;
      editId = id;
      document.getElementById('tituloModal').innerText = "Editar Cliente";
      document.getElementById('modalCliente').style.display='flex';
    }
  }, {onlyOnce:true});
};

window.excluirCliente = (id)=>{
  if(confirm("Tem certeza que deseja excluir este cliente?")){
    remove(ref(db,'clientes/'+id));
  }
};

// BUSCA POR NOME/EMAIL/TELEFONE
document.getElementById('btnBuscar').addEventListener('click', ()=>{
  const filtro = document.getElementById('buscaCliente').value;
  buscarClientes(filtro);
});

// INICIAL
buscarClientes();
</script>
</body>
</html>
