<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Pet - Funcionários</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; background: #f4f6f9; }
  
  /* Menu lateral padrão */
  nav { width: 220px; background: #1f2937; min-height: 100vh; color: white; padding-top: 20px; position: fixed; }
  nav h2 { text-align: center; margin-bottom: 30px; font-size: 22px; font-weight: 500; }
  nav a { display: flex; align-items: center; gap: 10px; color: white; padding: 12px 20px; text-decoration: none; font-weight: 500; transition: 0.3s; }
  nav a i { width: 20px; text-align: center; }
  nav a:hover, nav a.active { background: #374151; border-left: 4px solid #10b981; }
  
  main { margin-left: 220px; padding: 20px; flex: 1; }
  h1 { margin-bottom: 20px; }
  
  /* KPIs */
  .kpis { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
  .kpi { flex: 1; min-width: 180px; background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  .kpi h2 { margin: 10px 0; font-size: 24px; }

  /* Botão cadastrar */
  .btn-add { background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; float: right; margin-bottom: 20px; }
  .btn-add:hover { background: #0f9f6f; }

  /* Tabela */
  table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
  th { background: #1f2937; color: white; }
  td .actions { display: flex; gap: 10px; }
  td button { border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; }
  .delete { background: #ef4444; color: white; }
  select, input { width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #ccc; }
</style>
</head>
<body>
  <!-- Menu lateral padronizado -->
  <nav>
    <h2>Admin Pet</h2>
    <a href="clientes.html"><i class="fas fa-users"></i>Clientes</a>
    <a href="parceiros.html"><i class="fas fa-handshake"></i>Parceiros</a>
    <a href="funcionarios.html" class="active"><i class="fas fa-user-tie"></i>Funcionários</a>
  </nav>

  <main>
    <h1>Gestão de Funcionários</h1>
    <button class="btn-add" onclick="openModal()">Cadastrar Funcionário</button>

    <div class="kpis">
      <div class="kpi">
        <p>Total Funcionários Ativos</p>
        <h2 id="totalAtivos">0</h2>
      </div>
      <div class="kpi">
        <p>Total de Serviços Realizados</p>
        <h2 id="totalServicos">0</h2>
      </div>
      <div class="kpi">
        <p>Faturamento Total</p>
        <h2 id="totalFaturamento">R$ 0,00</h2>
      </div>
      <div class="kpi">
        <p>Média de Serviços por Funcionário</p>
        <h2 id="mediaServicos">0</h2>
      </div>
      <div class="kpi">
        <p>Média de Faturamento por Funcionário</p>
        <h2 id="mediaFaturamento">R$ 0,00</h2>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Cargo</th>
          <th>Status</th>
          <th>Admissão</th>
          <th>Serviços</th>
          <th>Faturamento</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="funcionariosList"></tbody>
    </table>
  </main>

  <!-- Modal Cadastro -->
  <div id="funcionarioModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h2 id="modalTitle">Cadastrar Funcionário</h2>
      <input type="hidden" id="funcionarioId">
      <input type="text" id="nome" placeholder="Nome do Funcionário">
      <input type="text" id="cargo" placeholder="Cargo">
      <select id="status">
        <option value="Ativo">Ativo</option>
        <option value="Desligado">Desligado</option>
      </select>
      <input type="date" id="admissao">
      <input type="number" id="servicos" placeholder="Serviços Realizados" value="0">
      <input type="number" id="faturamento" placeholder="Faturamento (R$)" value="0">
      <button class="save" onclick="saveFuncionario()">Salvar</button>
      <button class="close" onclick="closeModal()">Cancelar</button>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDVr6OOQRt2rB0kByInjqjdyoQCpnMAt7I",
  authDomain: "site-f6495.firebaseapp.com",
  projectId: "site-f6495",
  storageBucket: "site-f6495.firebasestorage.app",
  messagingSenderId: "230161402024",
  appId: "1:230161402024:web:462a911919ebf8a0809a9d",
  measurementId: "G-51G8XF6JH0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const modal = document.getElementById("funcionarioModal");
const funcionariosList = document.getElementById("funcionariosList");

function openModal(){ modal.style.display = "block"; }
function closeModal(){ modal.style.display = "none"; }

async function saveFuncionario(){
  const id = document.getElementById("funcionarioId").value;
  const funcionario = {
    nome: document.getElementById("nome").value,
    cargo: document.getElementById("cargo").value,
    status: document.getElementById("status").value,
    admissao: document.getElementById("admissao").value,
    servicos: parseInt(document.getElementById("servicos").value),
    faturamento: parseFloat(document.getElementById("faturamento").value),
    dataCadastro: new Date().toISOString()
  };

  if(id){
    const ref = doc(db, "funcionarios", id);
    await updateDoc(ref, funcionario);
  } else {
    await addDoc(collection(db, "funcionarios"), funcionario);
  }
  closeModal();
  loadFuncionarios();
}

async function loadFuncionarios(){
  funcionariosList.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "funcionarios"));
  let totalAtivos = 0, totalServicos = 0, totalFaturamento = 0;

  querySnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    if(data.status === "Ativo") totalAtivos++;
    totalServicos += data.servicos || 0;
    totalFaturamento += data.faturamento || 0;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${data.nome}</td>
      <td>${data.cargo}</td>
      <td>
        <select onchange="updateField('${docSnap.id}', 'status', this.value)">
          <option value='Ativo' ${data.status==='Ativo'?'selected':''}>Ativo</option>
          <option value='Desligado' ${data.status==='Desligado'?'selected':''}>Desligado</option>
        </select>
      </td>
      <td>${data.admissao}</td>
      <td><input type='number' value='${data.servicos||0}' onchange="updateField('${docSnap.id}', 'servicos', this.value)"/></td>
      <td>R$ <input type='number' value='${data.faturamento||0}' step='0.01' onchange="updateField('${docSnap.id}', 'faturamento', this.value)"/></td>
      <td class="actions">
        <button class="delete" onclick="deleteFuncionario('${docSnap.id}')">Excluir</button>
      </td>
    `;
    funcionariosList.appendChild(tr);
  });

  const totalFuncionarios = querySnapshot.size || 1;
  document.getElementById("totalAtivos").innerText = totalAtivos;
  document.getElementById("totalServicos").innerText = totalServicos;
  document.getElementById("totalFaturamento").innerText = `R$ ${totalFaturamento.toFixed(2)}`;
  document.getElementById("mediaServicos").innerText = (totalServicos/totalFuncionarios).toFixed(1);
  document.getElementById("mediaFaturamento").innerText = `R$ ${(totalFaturamento/totalFuncionarios).toFixed(2)}`;
}

async function updateField(id, field, value){
  const ref = doc(db, "funcionarios", id);
  const updateData = {};
  if(field==='servicos') updateData[field]=parseInt(value);
  else if(field==='faturamento') updateData[field]=parseFloat(value);
  else updateData[field]=value;
  await updateDoc(ref, updateData);
  loadFuncionarios();
}

async function deleteFuncionario(id){
  if(confirm("Deseja realmente excluir este funcionário?")){
    await deleteDoc(doc(db, "funcionarios", id));
    loadFuncionarios();
  }
}

window.onclick = function(event){ if(event.target==modal) closeModal(); }
loadFuncionarios();
</script>
</body>
</html>
