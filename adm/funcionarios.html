<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Pet - Funcionários</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f4f6f9; }
    header { background: #2c3e50; color: white; padding: 15px; text-align: center; font-size: 20px; }
    .container { padding: 20px; }
    .kpis { display: flex; gap: 20px; margin-bottom: 20px; }
    .kpi { flex: 1; background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .kpi h2 { margin: 10px 0; font-size: 24px; }
    .btn-add { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; float: right; margin-bottom: 20px; }
    .btn-add:hover { background: #219150; }
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    th { background: #2c3e50; color: white; }
    td .actions { display: flex; gap: 10px; }
    td button { border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; }
    .edit { background: #f39c12; color: white; }
    .delete { background: #e74c3c; color: white; }
    /* Modal */
    .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); }
    .modal-content { background: white; margin: 10% auto; padding: 20px; border-radius: 10px; width: 400px; }
    .modal-content h2 { margin-bottom: 15px; }
    .modal-content input, .modal-content select { width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; }
    .modal-content button { margin-top: 10px; padding: 10px; width: 100%; border: none; border-radius: 5px; cursor: pointer; }
    .save { background: #27ae60; color: white; }
    .close { background: #95a5a6; color: white; }
  </style>
</head>
<body>
  <header>Gestão de Funcionários</header>
  <div class="container">
    <button class="btn-add" onclick="openModal()">Cadastrar Funcionário</button>

    <div class="kpis">
      <div class="kpi">
        <p>Total Funcionários</p>
        <h2 id="totalFuncionarios">0</h2>
      </div>
      <div class="kpi">
        <p>Serviços Realizados</p>
        <h2 id="totalServicos">0</h2>
      </div>
      <div class="kpi">
        <p>Faturamento</p>
        <h2 id="totalFaturamento">R$ 0,00</h2>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Cargo</th>
          <th>Status</th>
          <th>Admissão</th>
          <th>Serviços</th>
          <th>Faturamento</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="funcionariosList"></tbody>
    </table>
  </div>

  <!-- Modal -->
  <div id="funcionarioModal" class="modal">
    <div class="modal-content">
      <h2 id="modalTitle">Cadastrar Funcionário</h2>
      <input type="hidden" id="funcionarioId">
      <input type="text" id="nome" placeholder="Nome do Funcionário">
      <input type="text" id="cargo" placeholder="Cargo">
      <select id="status">
        <option value="Ativo">Ativo</option>
        <option value="Férias">Férias</option>
        <option value="Desligado">Desligado</option>
      </select>
      <input type="date" id="admissao">
      <input type="number" id="servicos" placeholder="Serviços Realizados" value="0">
      <input type="number" id="faturamento" placeholder="Faturamento (R$)" value="0">
      <button class="save" onclick="saveFuncionario()">Salvar</button>
      <button class="close" onclick="closeModal()">Cancelar</button>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_AUTH_DOMAIN",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_STORAGE_BUCKET",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const modal = document.getElementById("funcionarioModal");
    const funcionariosList = document.getElementById("funcionariosList");

    function openModal(edit = false, funcionario = null) {
      modal.style.display = "block";
      document.getElementById("modalTitle").innerText = edit ? "Editar Funcionário" : "Cadastrar Funcionário";
      if(edit && funcionario){
        document.getElementById("funcionarioId").value = funcionario.id;
        document.getElementById("nome").value = funcionario.nome;
        document.getElementById("cargo").value = funcionario.cargo;
        document.getElementById("status").value = funcionario.status;
        document.getElementById("admissao").value = funcionario.admissao;
        document.getElementById("servicos").value = funcionario.servicos;
        document.getElementById("faturamento").value = funcionario.faturamento;
      } else {
        document.getElementById("funcionarioId").value = "";
        document.getElementById("nome").value = "";
        document.getElementById("cargo").value = "";
        document.getElementById("status").value = "Ativo";
        document.getElementById("admissao").value = "";
        document.getElementById("servicos").value = 0;
        document.getElementById("faturamento").value = 0;
      }
    }
    function closeModal(){ modal.style.display = "none"; }

    async function saveFuncionario() {
      const id = document.getElementById("funcionarioId").value;
      const funcionario = {
        nome: document.getElementById("nome").value,
        cargo: document.getElementById("cargo").value,
        status: document.getElementById("status").value,
        admissao: document.getElementById("admissao").value,
        servicos: parseInt(document.getElementById("servicos").value),
        faturamento: parseFloat(document.getElementById("faturamento").value),
        dataCadastro: new Date().toISOString()
      };

      if(id){
        const ref = doc(db, "funcionarios", id);
        await updateDoc(ref, funcionario);
      } else {
        await addDoc(collection(db, "funcionarios"), funcionario);
      }
      closeModal();
      loadFuncionarios();
    }

    async function loadFuncionarios() {
      funcionariosList.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "funcionarios"));
      let total = 0, totalServ = 0, totalFat = 0;

      querySnapshot.forEach(docSnap => {
        const data = docSnap.data();
        total++;
        totalServ += data.servicos || 0;
        totalFat += data.faturamento || 0;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${data.nome}</td>
          <td>${data.cargo}</td>
          <td>${data.status}</td>
          <td>${data.admissao}</td>
          <td>${data.servicos || 0}</td>
          <td>R$ ${(data.faturamento || 0).toFixed(2)}</td>
          <td class="actions">
            <button class="edit" onclick='openModal(true, ${JSON.stringify({id: docSnap.id, ...data})})'>Editar</button>
            <button class="delete" onclick="deleteFuncionario('${docSnap.id}')">Excluir</button>
          </td>
        `;
        funcionariosList.appendChild(tr);
      });

      document.getElementById("totalFuncionarios").innerText = total;
      document.getElementById("totalServicos").innerText = totalServ;
      document.getElementById("totalFaturamento").innerText = `R$ ${totalFat.toFixed(2)}`;
    }

    async function deleteFuncionario(id){
      if(confirm("Deseja realmente excluir este funcionário?")){
        await deleteDoc(doc(db, "funcionarios", id));
        loadFuncionarios();
      }
    }

    loadFuncionarios();
  </script>
</body>
</html>
