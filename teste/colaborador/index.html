<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Colaborador</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  body { margin:0; font-family:'Roboto',sans-serif; display:flex; height:100vh; background:#f5f6fa; }
  .sidebar { width:250px; background:#2c3e50; color:#fff; display:flex; flex-direction:column; padding-top:20px; }
  .sidebar h2{ text-align:center; margin-bottom:30px; font-size:20px; font-weight:700; }
  .sidebar a{ padding:15px 20px; text-decoration:none; color:#ecf0f1; display:block; transition:0.3s; font-weight:500; }
  .sidebar a:hover{ background:#34495e; }
  .sidebar a.active{ background:#1abc9c; color:#fff; }
  .content{ flex:1; padding:20px; overflow-y:auto; }
  h1{ font-size:24px; margin-bottom:20px; color:#2c3e50; }
  .resumo-pedidos{ display:flex; gap:20px; margin-bottom:20px; flex-wrap:wrap; }
  .card{ flex:1; min-width:150px; background:#fff; border-radius:12px; padding:15px; text-align:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  .card h3{ margin:0 0 10px; font-size:16px; color:#333; display:flex; align-items:center; justify-content:center; gap:8px; }
  .card p{ font-size:20px; font-weight:bold; margin:0; }
  .progress-bar{ height:8px; border-radius:4px; background:#ddd; margin-top:8px; overflow:hidden; }
  .progress{ height:100%; border-radius:4px; }
  .progress.aguardando{ background:#f39c12; }
  .progress.separacao{ background:#3498db; }
  .progress.finalizado{ background:#27ae60; }
  .progress.cancelado{ background:#e74c3c; }
  .filters{ display:flex; gap:15px; margin-bottom:20px; }
  .filters input,.filters select{ padding:8px; border-radius:8px; border:1px solid #ccc; flex:1; }
  table{ width:100%; border-collapse:collapse; background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  th,td{ padding:12px 15px; text-align:left; border-bottom:1px solid #eee; }
  th{ background:#2c3e50; color:#fff; }
  tr:hover{ background:#f9f9f9; }
  .status{ padding:6px 10px; border-radius:6px; font-size:14px; font-weight:500; color:#fff; }
  .aguardando{ background:#f39c12; }
  .separacao{ background:#3498db; }
  .finalizado{ background:#27ae60; }
  .cancelado{ background:#e74c3c; }
  .actions button{ padding:6px 12px; border:none; border-radius:6px; margin-right:5px; cursor:pointer; font-size:13px; }
  .btn-edit{ background:#3498db; color:#fff; }
  .btn-cancel{ background:#e74c3c; color:#fff; }
  .modal{ display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
  .modal-content{ background:#fff; padding:20px; border-radius:12px; width:500px; max-width:90%; box-shadow:0 2px 8px rgba(0,0,0,0.2); animation:fadeIn 0.3s ease-in-out; }
  .modal-header{ display:flex; justify-content:space-between; align-items:center; }
  .modal-header h2{ margin:0; }
  .close{ cursor:pointer; font-size:22px; font-weight:bold; color:#333; }
  .modal-body{ margin-top:15px; }
  .modal-body label{ display:block; margin:10px 0 5px; font-weight:500; }
  .modal-body select,.modal-body textarea{ width:100%; padding:8px; border:1px solid #ccc; border-radius:8px; }
  .modal-footer{ margin-top:15px; text-align:right; }
  .modal-footer button{ padding:8px 14px; border:none; border-radius:8px; cursor:pointer; margin-left:10px; }
  .btn-save{ background:#27ae60; color:#fff; }
  .btn-close{ background:#ccc; color:#000; }
  @keyframes fadeIn{ from{opacity:0;} to{opacity:1;} }
  .page{ display:none; }
  .page.active{ display:block; }
</style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
    <h2>Colaborador</h2>
    <a href="index.html" class="active" onclick="showPage('pedidos')">üì¶ Pedidos</a>
    <a href="clientes.html" onclick="showPage('clientes')">üë• Clientes</a>
    <a href="parceiros.html" onclick="showPage('parceiros')">ü§ù Parceiros</a>
    <a href="produtos.html" onclick="showPage('produtos')">üõí Produtos</a>
    <a href="agenda.html" onclick="showPage('agenda')">üìÖ Agenda</a>
    <a href="marketing.html" onclick="showPage('marketing')">üì¢ Marketing</a>
    <a href="kpi.html" onclick="showPage('kpis')">üìä KPI‚Äôs</a>
  </div>

  <div class="content">
    <div id="pedidos" class="page active">
      <h1>üì¶ Pedidos</h1>
      <div class="resumo-pedidos">
        <div class="card"><h3>üìã Total</h3><p id="totalPedidos">0</p></div>
        <div class="card"><h3>‚è≥ Aguardando</h3><p id="pedidosAguardando">0</p><div class="progress-bar"><div class="progress aguardando" id="progressAguardando"></div></div></div>
        <div class="card"><h3>üì¶ Em Separa√ß√£o</h3><p id="pedidosSeparacao">0</p><div class="progress-bar"><div class="progress separacao" id="progressSeparacao"></div></div></div>
        <div class="card"><h3>‚úÖ Finalizados</h3><p id="pedidosFinalizados">0</p><div class="progress-bar"><div class="progress finalizado" id="progressFinalizado"></div></div></div>
        <div class="card"><h3>‚ùå Cancelados</h3><p id="pedidosCancelados">0</p><div class="progress-bar"><div class="progress cancelado" id="progressCancelado"></div></div></div>
      </div>
      <div class="filters">
        <input type="text" placeholder="Buscar cliente ou pedido...">
        <select>
          <option value="">Todos os status</option>
          <option value="aguardando">Aguardando</option>
          <option value="separacao">Em separa√ß√£o</option>
          <option value="finalizado">Finalizado</option>
          <option value="cancelado">Cancelado</option>
        </select>
      </div>
      <table>
        <thead>
          <tr>
            <th>ID</th><th>Cliente</th><th>Produtos</th><th>Valor</th><th>Data</th><th>Status</th><th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaPedidos"></tbody>
      </table>
    </div>

  <!-- Modal -->
  <div id="pedidoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Detalhes do Pedido</h2>
        <span class="close" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <p><strong>ID:</strong> <span id="pedidoId"></span></p>
        <p><strong>Cliente:</strong> <span id="pedidoCliente"></span></p>
        <p><strong>Produtos:</strong> <span id="pedidoProdutos"></span></p>
        <p><strong>Valor:</strong> <span id="pedidoValor"></span></p>
        <p><strong>Data:</strong> <span id="pedidoData"></span></p>
        <label for="statusSelect">Status:</label>
        <select id="statusSelect">
          <option value="aguardando">Aguardando</option>
          <option value="separacao">Em separa√ß√£o</option>
          <option value="finalizado">Finalizado</option>
          <option value="cancelado">Cancelado</option>
        </select>
        <label for="observacoes">Observa√ß√µes:</label>
        <textarea id="observacoes" rows="3" placeholder="Digite observa√ß√µes internas..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn-close" onclick="closeModal()">Fechar</button>
        <button class="btn-save" onclick="salvarAlteracoes()">Salvar</button>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCLBni8BY6zjHGMuoybZ06SBK4U9c1BhyE",
  authDomain: "petdudis-db2b2.firebaseapp.com",
  projectId: "petdudis-db2b2",
  storageBucket: "petdudis-db2b2.firebasestorage.app",
  messagingSenderId: "410321083813",
  appId: "1:410321083813:web:eaf0082878a8281eab5c4c"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let pedidosData = {};

  // Trocar de p√°gina
  window.showPage = function(pageId, e){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.sidebar a').forEach(l=>l.classList.remove('active'));
    e.target.classList.add('active');
  }

  // Carregar pedidos em tempo real
  function carregarPedidos(){
    const pedidosRef = collection(db, "pedidos");
    onSnapshot(pedidosRef, (snapshot)=>{
      pedidosData={};
      let tbody=document.getElementById("tabelaPedidos");
      tbody.innerHTML="";
      snapshot.forEach(docSnap=>{
        let p=docSnap.data(), id=docSnap.id;
        pedidosData[id]=p;
        let row=document.createElement("tr");
        row.innerHTML=`
          <td>${id}</td>
          <td>${p.cliente}</td>
          <td>${p.produtos}</td>
          <td>${p.valor}</td>
          <td>${p.data}</td>
          <td><span class="status ${p.status}">${p.status}</span></td>
          <td class="actions">
            <button class="btn-edit" onclick="openModal('${id}')">Editar</button>
            <button class="btn-cancel" onclick="cancelarPedido('${id}')">Cancelar</button>
          </td>`;
        tbody.appendChild(row);
      });
      atualizarResumo();
    });
  }

  // Abrir modal
  window.openModal=function(id){
    const p=pedidosData[id];
    document.getElementById("pedidoId").innerText=id;
    document.getElementById("pedidoCliente").innerText=p.cliente;
    document.getElementById("pedidoProdutos").innerText=p.produtos;
    document.getElementById("pedidoValor").innerText=p.valor;
    document.getElementById("pedidoData").innerText=p.data;
    document.getElementById("statusSelect").value=p.status;
    document.getElementById("observacoes").value=p.observacoes||"";
    document.getElementById("pedidoModal").style.display="flex";
  }

  // Fechar modal
  window.closeModal=function(){
    document.getElementById("pedidoModal").style.display="none";
  }

  // Salvar altera√ß√µes
  window.salvarAlteracoes=async function(){
    const id=document.getElementById("pedidoId").innerText;
    const novoStatus=document.getElementById("statusSelect").value;
    const observacoes=document.getElementById("observacoes").value;
    const pedidoRef=doc(db,"pedidos",id);
    await updateDoc(pedidoRef,{status:novoStatus,observacoes});
    alert(`Pedido ${id} atualizado!`);
    closeModal();
  }

  // Cancelar pedido
  window.cancelarPedido=async function(id){
    if(confirm(`Deseja cancelar o pedido ${id}?`)){
      const pedidoRef=doc(db,"pedidos",id);
      await updateDoc(pedidoRef,{status:"cancelado"});
      alert(`Pedido ${id} cancelado!`);
    }
  }

  // Atualizar resumo
  function atualizarResumo(){
    let total=0, aguardando=0, separacao=0, finalizado=0, cancelado=0;
    Object.values(pedidosData).forEach(p=>{
      total++;
      if(p.status==="aguardando") aguardando++;
      else if(p.status==="separacao") separacao++;
      else if(p.status==="finalizado") finalizado++;
      else if(p.status==="cancelado") cancelado++;
    });
    document.getElementById("totalPedidos").innerText=total;
    document.getElementById("pedidosAguardando").innerText=aguardando;
    document.getElementById("pedidosSeparacao").innerText=separacao;
    document.getElementById("pedidosFinalizados").innerText=finalizado;
    document.getElementById("pedidosCancelados").innerText=cancelado;
    const pct=n=>total?Math.round(n/total*100):0;
    document.getElementById("progressAguardando").style.width=pct(aguardando)+"%";
    document.getElementById("progressSeparacao").style.width=pct(separacao)+"%";
    document.getElementById("progressFinalizado").style.width=pct(finalizado)+"%";
    document.getElementById("progressCancelado").style.width=pct(cancelado)+"%";
  }

  carregarPedidos();
</script>
</body>
</html>
