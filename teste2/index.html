<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loja - Página Inicial</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_DOMINIO.firebaseapp.com",
      projectId: "SEU_PROJECT_ID",
      storageBucket: "SEU_BUCKET.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "SEU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #6a1b9a; color: #fff; padding: 10px 20px; display:flex; justify-content:space-between; align-items:center; }
    header .logo { font-size: 22px; font-weight: bold; }
    header .acoes-usuario a { color:#fff; margin-left:15px; text-decoration:none; }
    .banner { background:#f3e5f5; text-align:center; padding:50px 20px; }
    .mais-vendidos, .marcas { padding:40px 20px; }
    .produtos-destaque { display:flex; flex-wrap:wrap; gap:20px; }
    .produto { border:1px solid #ddd; padding:15px; border-radius:8px; flex:1 1 calc(25% - 20px); box-sizing:border-box; }
    .produto img { max-width:100%; border-radius:6px; }
    .marcas-container { display:flex; flex-wrap:wrap; gap:15px; align-items:center; justify-content:center; }
    .marcas-container img { max-height:50px; }
    footer { background:#4a148c; color:#fff; text-align:center; padding:20px; margin-top:30px; }
  </style>
</head>
<body>
  <header>
    <div class="logo">Minha Loja</div>
    <div class="acoes-usuario">
      <a href="#" id="link-entrar"><i class="fas fa-user"></i> Entrar | Cadastrar</a>
      <a href="#"><i class="fas fa-sync-alt"></i> Recorrência</a>
      <a href="#"><i class="fas fa-box"></i> Pedidos</a>
    </div>
  </header>

  <section class="banner">
    <h1>Bem-vindo à Loja</h1>
    <p>As melhores ofertas para você</p>
  </section>

  <section class="mais-vendidos">
    <h2>Mais Vendidos</h2>
    <div class="produtos-destaque">
      <!-- Produtos carregados dinamicamente -->
    </div>
  </section>

  <section class="marcas">
    <h2>Nossas Marcas</h2>
    <div class="marcas-container">
      <!-- Marcas carregadas dinamicamente -->
    </div>
  </section>

  <footer>
    <p>&copy; 2025 Minha Loja - Todos os direitos reservados.</p>
  </footer>

  <!-- Script principal -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const auth = firebase.auth();
    const db = firebase.firestore();
    const acoesUsuario = document.querySelector('.acoes-usuario');

    // --- Modal Login ---
    function criarModalLogin() {
      if (document.getElementById('modal-login')) return;

      const modal = document.createElement('div');
      modal.id = 'modal-login';
      modal.style.cssText = `
        display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5);
        justify-content:center; align-items:center; z-index:9999;
      `;
      modal.innerHTML = `
        <div style="background:#fff; padding:20px; border-radius:10px; max-width:320px; width:90%; position:relative;">
          <span id="modal-fechar" style="position:absolute; top:8px; right:12px; font-size:24px; cursor:pointer; color:#666;">&times;</span>
          <h2 style="margin-top:0; color:#4a148c;">Entrar</h2>
          <form id="form-login" style="display:flex; flex-direction:column; gap:12px;">
            <input type="email" id="login-email" placeholder="E-mail" required />
            <input type="password" id="login-senha" placeholder="Senha" required />
            <button type="submit" style="background:#6a1b9a; color:#fff; border:none; padding:10px; border-radius:6px; cursor:pointer;">Entrar</button>
            <div id="login-erro" style="color:#d32f2f; font-size:14px; display:none;"></div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);

      modal.querySelector('#modal-fechar').onclick = () => modal.style.display = 'none';
      modal.onclick = (e) => { if (e.target === modal) modal.style.display = 'none'; };

      modal.querySelector('#form-login').addEventListener('submit', async e => {
        e.preventDefault();
        const email = document.getElementById('login-email').value.trim();
        const senha = document.getElementById('login-senha').value.trim();
        try {
          await auth.signInWithEmailAndPassword(email, senha);
          modal.style.display = 'none';
        } catch (err) {
          const erroDiv = document.getElementById('login-erro');
          erroDiv.textContent = err.message;
          erroDiv.style.display = 'block';
        }
      });
    }
    criarModalLogin();

    // abrir modal ao clicar no link
    function ativarLinkLogin() {
      const link = document.getElementById('link-entrar');
      if (link) {
        link.addEventListener('click', e => {
          e.preventDefault();
          document.getElementById('modal-login').style.display = 'flex';
        });
      }
    }
    ativarLinkLogin();

    // Estado do usuário
    auth.onAuthStateChanged(user => {
      if (!acoesUsuario) return;
      if (user) {
        const nome = user.displayName || user.email.split('@')[0];
        acoesUsuario.innerHTML = `
          <span style="color:#4a148c; font-weight:700; margin-right:12px;">Olá, ${nome}</span>
          <a href="#" id="btn-logout" style="color:#d32f2f; font-weight:700;">Sair</a>
        `;
        document.getElementById('btn-logout').addEventListener('click', async e => {
          e.preventDefault();
          await auth.signOut();
          location.reload();
        });
      } else {
        acoesUsuario.innerHTML = `
          <a href="#" id="link-entrar"><i class="fas fa-user"></i> Entrar | Cadastrar</a>
          <a href="#"><i class="fas fa-sync-alt"></i> Recorrência</a>
          <a href="#"><i class="fas fa-box"></i> Pedidos</a>
        `;
        ativarLinkLogin();
      }
    });

    // --- Mais vendidos ---
    const containerMaisVendidos = document.querySelector('.mais-vendidos .produtos-destaque');
    async function carregarMaisVendidos() {
      if (!containerMaisVendidos) return;
      containerMaisVendidos.innerHTML = 'Carregando...';
      try {
        const snapshot = await db.collection('mais_vendidos').orderBy('ordem','asc').limit(10).get();
        containerMaisVendidos.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          containerMaisVendidos.innerHTML += `
            <div class="produto">
              <img src="${data.imagem || 'https://via.placeholder.com/150'}" alt="${data.nome || ''}" />
              <h3>${data.nome || ''}</h3>
              <p>${data.descricao || ''}</p>
              <span class="preco">${data.preco || ''}</span>
            </div>
          `;
        });
      } catch (err) {
        containerMaisVendidos.innerHTML = `<p style="color:#d32f2f;">Erro: ${err.message}</p>`;
      }
    }

    // --- Marcas ---
    const containerMarcas = document.querySelector('.marcas-container');
    async function carregarMarcas() {
      if (!containerMarcas) return;
      containerMarcas.innerHTML = 'Carregando...';
      try {
        const snapshot = await db.collection('marcas').orderBy('ordem','asc').limit(20).get();
        containerMarcas.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          containerMarcas.innerHTML += `
            <img src="${data.logoUrl || 'https://via.placeholder.com/120x50?text=Marca'}" alt="${data.nome || 'Marca'}" />
          `;
        });
      } catch (err) {
        containerMarcas.innerHTML = `<p style="color:#d32f2f;">Erro: ${err.message}</p>`;
      }
    }

    carregarMaisVendidos();
    carregarMarcas();
  });
  </script>
</body>
</html>
